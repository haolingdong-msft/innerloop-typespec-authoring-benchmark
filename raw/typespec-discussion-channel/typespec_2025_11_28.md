# JS SDK generation issue - ResourceUpdateModel and location

## question 
Hi,
We have this issue with JS code gen triggered from release plan for our preview SDK. 
There is an issue with JS where the emitter incorrectly makes location required in update for some of our new resource types.
```
Property 'location' is missing in type '{ properties: { dailyBackupsToKeep: number; weeklyBackupsToKeep: number; monthlyBackupsToKeep: number; policyState: string; }; }' but required in type 'ElasticBackupPolicy'.
```
But location is not required in update (patch) that uses ResourceUpdateModel that should make location optional.
That does not seem to be an issue in other SDK languages. 
How can we fix this issue ?

[Pipelines - Run 20251126.1 logs](https://dev.azure.com/azure-sdk/internal/internal%20Team/_build/results?buildId=5613012&view=logs&j=83516c17-6666-5250-abde-63983ce72a49&t=00be4b52-4a63-5865-8e02-c61723ad0692&l=3447)
```
Errors occurred while generating SDK from specification/netapp/resource-manager/Microsoft.NetApp/NetApp/tspconfig.yaml . Follow the steps at https://aka.ms/azsdk/sdk-automation-faq#how-to-view-the-detailed-sdk-generation-errors to view detailed errors.
##[error]Errors occurred while generating SDK from specification/netapp/resource-manager/Microsoft.NetApp/NetApp/tspconfig.yaml . Follow the steps at https://aka.ms/azsdk/sdk-automation-faq#how-to-view-the-detailed-sdk-generation-errors to view detailed errors.
[ERROR]: Command closed with code '2'.
[ERROR]: Exit code: 2
[ERROR]: Summary:
[ERROR]:   samples-dev/elasticBackupPoliciesUpdateSample.ts(17,100): error TS2345: Argument of type '{ properties: { dailyBackupsToKeep: number; weeklyBackupsToKeep: number; monthlyBackupsToKeep: number; policyState: string; }; }' is not assignable to parameter of type 'ElasticBackupPolicy'.
[ERROR]:   samples-dev/elasticBackupVaultsUpdateSample.ts(17,94): error TS2345: Argument of type '{ tags: { Tag1: string; }; }' is not assignable to parameter of type 'ElasticBackupVault'.
[ERROR]:   samples-dev/elasticSnapshotPoliciesUpdateSample.ts(21,5): error TS2345: Argument of type '{ properties: { policyStatus: string; hourlySchedule: { snapshotsToKeep: number; minute: number; }; dailySchedule: { snapshotsToKeep: number; hour: number; minute: number; }; weeklySchedule: { snapshotsToKeep: number; days: string[]; hour: number; minute: number; }; monthlySchedule: { ...; }; }; }' is not assignable to parameter of type 'ElasticSnapshotPolicy'.
The generation process failed for specification-netapp-resource-manager-Microsoft.NetApp-NetApp-tspconfig.yaml. Refer to the full log for details.

```

## answer
in this case, you need to use ArmCustomPatchAsync instead of ArmResourcePatchAsync for patch operations which is our recommendation
like:
```
  update is ArmCustomPatchAsync<
    ElasticBackup,
    Azure.ResourceManager.Foundations.ResourceUpdateModel<
      ElasticBackup,
      ElasticBackupProperties
    >
  >;
```

# Questions About Maintaining TypeSpec and Reducing Learning Costs

## question 
I'm from the MySQL service team. I’ve already migrated the swagger to TypeSpec, but I have two questions and would like to ask if you have any best practices.
1. How do you maintain TypeSpec in parallel?
Here are our common scenarios: we usually have two versions in progress.
For example, the 2025-09-01 version is almost finished — we’re waiting for the backend code to be ready before we can release it, though we may still have some small changes.
Another version, 2025-12-01, has just started. Feature owners are designing their features and want to start merging code into this version.
How can we develop these two versions in parallel? I don’t have permission to create branches.
2. For the server team, each feature owner needs to write their own feature, which means everyone has to understand how to write TypeSpec.
How can we reduce their learning and writing cost?

## answer
1. `don’t have permission to create branches.`
I think this might mean you haven't onboarded to the repo correctly. I would expect this to be the workflow if you need to work on a new version of a non released one to just branch of in the spec repo
https://eng.ms/docs/products/azure-developer-experience/onboard/access#write-access
Once you have permissions, you should be able to create branches in both the public and private spec repos.  You can create branches with names like feature/mysql/2025-09-01 (or whatever you want) to organize your work.  You can look at existing branch names for patterns to follow.
https://github.com/Azure/azure-rest-api-specs/branches
https://eng.ms/docs/products/azure-developer-experience/design/api-specs-pr/api-versions-and-branches

2. The best resource for learning learning TypeSpec is the [documentation](https://azure.github.io/typespec-azure/docs/getstarted/azure-resource-manager/step00/).  TypeSpec supports syntax-directed editing using the vscode extension, which simplifies the authoring process and shows linting rule violations as you compose the spec, so that lintdiff errors don't come as a surprise on check-in.
TypeSpec for ARM and data plane also has a set of types and templates that make composing a spec compliant with the RPC or Azure API Guidelines easier, and you can create your own templates, if there are additional common patterns in your APIs that team members should use.
Authors should always feel free to ask questions in this channel, internal StackOverflow, or attend office hours (Mondays at 4PM PST)

# Unable to apply client flatten to a top level resource property.

## question 
my existing open api spec, of a proxy resource is such
```
"ArcSetting": {
      "description": "ArcSetting details.",
      "type": "object",
      "allOf": [
        {
          "$ref": "../../../../../../common-types/resource-management/v5/types.json#/definitions/ProxyResource"
        }
      ],
      "properties": {
        "properties": {
          "description": "ArcSetting properties.",
          "$ref": "#/definitions/ArcSettingProperties",
          "x-ms-client-flatten": true
        }
      }
    },
```
To convert it to typespec, here is what my tsp looks
```
/**
 * ArcSetting details.
 */
@parentResource(Cluster)
model ArcSetting is Azure.ResourceManager.ProxyResource<ArcSettingProperties> {
  ...ResourceNameParameter<
    Resource = ArcSetting,
    KeyName = "arcSettingName",
    SegmentName = "arcSettings",
    NamePattern = ""
  >;
}
```
the output is missing, the client-flatten property
```
"ArcSetting": {
      "type": "object",
      "description": "ArcSetting details.",
      "properties": {
        "properties": {
          "$ref": "#/definitions/ArcSettingProperties",
          "description": "ArcSetting properties."
        }
      },
      "allOf": [
        {
          "$ref": "../../../../../../common-types/resource-management/v6/types.json#/definitions/ProxyResource"
        }
      ]
    },
```
Is there a possible way to add this flag, or what is the implication for the existing SDK

## answer
Add
@@Azure.ClientGenerator.Core.Legacy.flattenProperty(ArcSettings.propeties)
By convention put this in a back-compatible.tsp file.