# Quantum RP, add new filter to offering API

**Category: Operations**

## question 
Hi team,
 
[Quantum [dev]: Add kind (v1/v2) to workspace by 04diiguyi · Pull Request #25310 · Azure/azure-rest-…](https://github.com/Azure/azure-rest-api-specs-pr/pull/25310/commits/e400cd4c150910e6e4837cda4be0ef51bec7b496)
 
The existing function is:
listBySubscription is ArmListBySubscription<QuantumSuiteOffer>;
 
Now our service supports filter, so I would like to change it to:
```
  listBySubscription is ArmListBySubscription<
    QuantumSuiteOffer,
    Parameters = {
      /**
       * The filter to apply to the operation. Example: '$filter=kind eq 'v1'
       */
      @query("$filter")
      $filter?: string;
    }
>;
```
 
However, the versioning breaks. It does not work if I change to:
```
  @removed(Versions.v2025_11_01_preview)
  listBySubscription is ArmListBySubscription<QuantumSuiteOffer>;
 
  @added(Versions.v2025_11_01_preview)
  listBySubscription is ArmListBySubscription<
    QuantumSuiteOffer,
    Parameters = {
      /**
       * The filter to apply to the operation. Example: '$filter=kind eq 'v1'
       */
      @query("$filter")
      $filter?: string;
    }
  >;
``` 
Or
```
  @removed(Versions.v2025_11_01_preview)
  listBySubscription is ArmListBySubscription<QuantumSuiteOffer>;
 
  @added(Versions.v2025_11_01_preview)
  listBySubscriptionV2 is ArmListBySubscription<
    QuantumSuiteOffer,
    Parameters = {
      /**
       * The filter to apply to the operation. Example: '$filter=kind eq 'v1'
       */
      @query("$filter")
      $filter?: string;
    }
  >;
``` 
Could anyone provide suggestions how I can fix this issue? Thanks

## answer
For a case like this, just decorating the filter property with `@added` in the same operation is the simplest mechanism.  Versioning the request and response data in an operation like this is usually the most straightforward way to version an operation.
 
For more complex operation versioning, you can use the remove/rename/sharedRoute mechanism described here: [Versioning | TypeSpec Azure](https://azure.github.io/typespec-azure/docs/howtos/arm/versioning/#converting-an-operation-from-synchronous-to-asynchronous)
 
Note also that you should name the property 'filter', the `@query("$filter")` decorator actually sets the name on the wire,  you generally want to follow standard naming rules for parameters:
```
// v2 (new preview)
listBySubscription is ArmListBySubscription<
  QuantumSuiteOffer,
  Parameters = {
    /**
     * The filter to apply to the operation. Example: '$filter=kind eq "v1"'
     */
    @added(Versions.v2025_11_01_preview)
    @query("$filter")
    filter?: string;
  }
>;
```

# Observing unexpected behavior while generating json file from model definitions

**Category: SDK Generation**

## question 
I have made a change where I introduced two new optional parameters to the existing KeyAttribute model. When I run the command, `npx tsv specification\keyvault\Security.KeyVault.Keys` the `keys.json` file it generates contain `ExternalKeyUpdate` and `KeyAttributesUpdate`. I have defined neither of the *Update in the typespec. This behavior was not observed in the past (Appending suffix Update to the models). 
 
Could you please kindly help if you have any idea why this is the case. Please find the PR below.
 
https://github.com/Azure/azure-rest-api-specs/pull/38557/files

## answer
it is because it is used in an update method where you have `@patch(#{implicitOptionality: true})` probably and this adds a required property nested(`ExternalKey.id`) which then require the need to create new models where everything is optional.
if you stop using @patch(#{implicitOptionality: true}) it will stop creating the model for you and its up to you to describe the accurate patch model.
It is generally preferred that you use `#{implictOptionality: false}`  because this ensures the patch model is correctly defined for use in SDKs (although, admittedly, sdk emitters tend to construct their own patch request models anyway).  There are some templates that allow transforming your types for patch [as in this playground](https://azure.github.io/typespec-azure/playground/?options=%7B%22linterRuleSet%22%3A%7B%22extends%22%3A%5B%22%40azure-tools%2Ftypespec-azure-rulesets%2Fresource-manager%22%5D%7D%7D&c=aW1wb3J0ICJAdHlwZXNwZWMvaHR0cCI7CtIZcmVzdNUZdmVyc2lvbmluZ8wfYXp1cmUtdG9vbHMvyCstxhVjb3Jl3yvIK3Jlc291cmNlLW1hbmFnZXIiOwoKdXNpbmcgSHR0cDvHDFJlc3TIDFbpAI7IEkHESi5Db3JlzhJSx1xNxls7CgovKiogQ29udG9zb8RUxR4gUHJvdmlkZXIg5gCDbWVudCBBUEkuICovCkBhcm3IIE5hbWVzcGFjZQpAc2VydmljZSgjeyB0aXRsZTogIsdXyC1IdWJDbGllbnQiIH0pCkDnAUNlZCjnAL9zKQpuyFAgTWljcm9zb2Z0LtJG7wC2QVBJIMdNc%2BQAoWVudW3oARNzIHsKICDELjIwMjEtMTAtMDEtcHJldmlld8g1xDQgIOQA10NvbW1vblTkAY%2FHQCj1ATcuyykuyGoudjUpCiAgYNJpYCwKfeYAs0HoALXrAM4g6AHw5ACIbW9kZWwgRW1wbG95ZWUgaXMgVHJhY2tlZOgAgjzIHFByb3BlcnRpZXM%2B5QDkLi7pAKbkAZZQYXJhbWV0ZXLJMT476ACGyV9wyUTSfMpg6QFDQWdlIG9mIGXIP%2BUBOGFnZT86IGludDMyOwrHKUNpdHnSKmNpdHk%2FOiBzdHLlAqnHLFByb2ZpbNNZQGVuY29kZSgiYmFzZTY0dXJsIuQBYHDGMD86IGJ5dGVzyUhUaGUgc3RhdHVzxEt0aGUgbGFzdCDkAMVhdGlvbuUCvCAgQHZpc2liaWxpdHkoTGlmZWN5Y2zkAeBhZMddxCDlA0tTdGF0xGflAavMFOkBSMRzzDLlAIDlAMph6QHVxXdAbHJvxDt1cwp1buQCctFU5QFk5gEaLOwA0shHIGNyZcQncmVxdWVzdCBoYXMgYmVlbiBhY2NlcHRlZMRnICBBxw46ICLICyLWUGnEQOQAtOkAwchE7ACcOiAizA%2FaTHVwZGF0xE%2FFQ1XHDjogIsgLyjvpBGXpAMTmANxk5wGiU3VjY2VlZOUAxckM0z%2FFNuQBTWZhaWzJPkbFDTogIsYJ3Dh3YXMgY2FuY2XKPkPHD%2BQEvccL%2FwFAIGRlbGXpAYBExA3mAPnICyLpA%2F3pA3dtb3bqAcrpA3lNb3ZlUscV6ANyxHNtb3bEaGZyb20gbG9j5gC8xW7EE%2FEDUMszdG%2FPMXRvyi%2F3AJVzcG9uc%2BsEi%2BYAlscW7ACX7gNsxT7FZMZ85gLuzW5hbGlhcyBQYXRjaE3EWzwKICBUIGV4dGVuZHMge30sCiAga2V5c8kTxjwgPSAiIgo%2BID0gT3DkAMphbOoEmjzlAl5lYWJs6wSvPE9taXREZWZhdWx0xg3LHMR0yGkKPj4%2BPjsK8AT45AChyjLkAenrALTzBX7WQtc4LCAi5AbkIiB8ICLqBX4i5gXD5AFbcnAt5AgLaWZpY%2B8Fn%2BUEnscQPzr4ALDlAWtpbnRlcmbkB0dP6AT%2F6gFX9gbSyyl7fQrlB%2BXII8oby1nIf%2BYGHmdldOQA8UHKNeQFUuwGeyDnA%2BZPcuYBtM8vQ8cdUmVwbGFjZUFzeW5jzj%2FlBGLIN0N1c3RvbeUA%2B1PMKizuARfFOeYDoc9w5QOeZVdpdGhvdXRPa9NwbGlzdEJ5yDBHcm91cM9ETMUiUGFyZW501DxTdWJzY3Jp5QK2xzvGM8wZzDnoB2cgc2FtcGzrBG1hY8VEdGhhdOYDaukHKnRvIGRpZmZl5ACE7wPtxSnuALJBxUjvATLrBHjIDeYD7%2FMAkkhFQUTqB1PEfmNoZWNr6gCqZXhpc3RlbuYIzSDGHkXJFO8B9M0d7gio&e=%40azure-tools%2Ftypespec-autorest&vs=%7B%7D):
```
alias PatchModel<
  T extends {},
  keys extends string = ""
> = OptionalProperties<UpdateableProperties<OmitDefaults<OmitProperties<
  T,
  keys
>>>>;

model EmployeePatchProperties is PatchModel<EmployeeProperties>;

model EmployeePatch is PatchModel<Employee, "name" | "properties"> {
  /** rp-specific properties */
  properties?: EmployeePatchProperties;
}
```

# Typespec generating examples that with invalid values for fields like provisioning state

**Category: SDK Generation**

## question 
We noticed this issue when reviewing our REST api official docs
[Edge Actions | Microsoft Learn](https://review.learn.microsoft.com/en-us/rest/api/edge-actions/operation-groups?view=rest-edge-actions-2025-09-01-preview&branch=edgeaction)
```
Sample response
Status code: 201


{
  "id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testrg/providers/Microsoft.Cdn/ed
  "name": "edgeAction1",
  "type": "Microsoft.Cdn/edgeActions",
  "location": "global",
  "sku": {
    "name": "Standard",
    "tier": "Standard"
  },
  "properties": {
    "provisioningState": "Accepted",
    "attachments": []
  }
}
```
Provisioning state has incorrect value of Accepted. It turns out this is coming from the examples generated from the typespec api spec
 
Provisioning state in our typespec is an enum that does not have Accepted as one of the values
```
/** The status of the current operation */
@Azure.Core.lroStatus
union ProvisioningState {
  ResourceProvisioningState,

  @doc("Initial provisioning in progress")
  Provisioning: "Provisioning",

  @doc("Upgrade in progress")
  Upgrading: "Upgrading",
}
```
I tried to see if we could manually fix these examples to align with the correct values. But i got the errors below
 
[Fix EdgeActions 2025-09-01-preview examples: remove invalid provisioning state and SKU values by tu…](https://github.com/Azure/azure-rest-api-specs/pull/38655)
```
diff --git a/specification/cdn/resource-manager/Microsoft.Cdn/edgeactions/preview/2025-09-01-preview/examples/EdgeActionVersions_Create.json b/specification/cdn/resource-manager/Microsoft.Cdn/edgeactions/preview/2025-09-01-preview/examples/EdgeActionVersions_Create.json

--- a/specification/cdn/resource-manager/Microsoft.Cdn/edgeactions/preview/2025-09-01-preview/examples/EdgeActionVersions_Create.json
+++ b/specification/cdn/resource-manager/Microsoft.Cdn/edgeactions/preview/2025-09-01-preview/examples/EdgeActionVersions_Create.json
@@ -23,7 +23,7 @@
   "type": "Microsoft.Cdn/edgeactions/versions",
   "location": "global",
   "properties": {
-    "provisioningState": "Succeeded",
+    "provisioningState": "Accepted",
     "deploymentType": "zip",
     "validationStatus": "Succeeded",
     "isDefaultVersion": "True"
   }
 }
diff --git a/specification/cdn/resource-manager/Microsoft.Cdn/edgeactions/preview/2025-09-01-preview/examples/EdgeActions_Create.json b/specification/cdn/resource-manager/Microsoft.Cdn/edgeactions/preview/2025-09-01-preview/examples/EdgeActions_Create.json

--- a/specification/cdn/resource-manager/Microsoft.Cdn/edgeactions/preview/2025-09-01-preview/examples/EdgeActions_Create.json
+++ b/specification/cdn/resource-manager/Microsoft.Cdn/edgeactions/preview/2025-09-01-preview/examples/EdgeActions_Create.json
@@ -26,7 +26,7 @@
      "tier": "Standard"
   },
   "properties": {
-    "provisioningState": "Succeeded",
+    "provisioningState": "Accepted",
     "attachments": []
   }
 }
```
Is there a way to control what values typespec uses in the examples?

## answer
You need to update both the source and destination copies of your examples, either manually, or by updating the source then running "tsp compile" to update the destination.
 
source: https://github.com/Azure/azure-rest-api-specs/tree/fed6c8945de99c818882a91821cc72ad1fb14dc3/specification/cdn/resource-manager/Microsoft.Cdn/EdgeActions/examples/2025-09-01-preview
 
destination: https://github.com/Azure/azure-rest-api-specs/tree/fed6c8945de99c818882a91821cc72ad1fb14dc3/specification/cdn/resource-manager/Microsoft.Cdn/EdgeActions/preview/2025-09-01-preview/examples
 
These instructions are useful anytime you want to locally debug a failure of TypeSpecValidation in your PR:
 
https://github.com/Azure/azure-rest-api-specs/wiki/TypeSpec-Validation#running-locally