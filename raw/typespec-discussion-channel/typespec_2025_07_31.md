# Looking for examples on running TypeSpec in ADO Pipelines

## question 
We're looking to work in ADO internally before promoting swagger to github - is there any examples of teams using the TypeSpec method for swagger internally vai ADO pipelines?

## answer
https://azure.github.io/typespec-azure/docs/howtos/rest-api-publish/buildpipelines/#_top
but this is only about typespec itself. If you plan to merge in the spec repo later there is many additional validations that will not be verified this way
A large set of them are available to install and run locally: [azure-rest-api-specs/documentation/SwaggerValidationTools.md at master · Azure/azure-rest-api-specs](https://github.com/Azure/azure-rest-api-specs/blob/master/documentation/SwaggerValidationTools.md):
```
There are some tools that can help you make sure your specifications conform to the accepted guidelines. Better upfront validation before the final pull request is sent will result in quicker turnaround time.

Validation tools available locally
The various tools mentioned above are also available for local download.

Install Node.js (7.10.0 or greater)
Linter Validator:

 - `npm install -g autorest`
 -  `autoRest <path to readme.md> --azure-validator=true`
Static Validator (Semantic):

 - `npm install -g oav`
 - `bash-3.2$ oav validate-spec <spec-path>`
Static Validator (Model):

 - `npm install -g oav`
 - `bash-3.2$ oav validate-example <spec-path>`
Swagger diff tool

 - `npm install -g oad@0.1.7`
 - `bash-3.2$ oad compare <old-spec> <new-spec>`
```
The TypeSpec validation tool (tsv) is also available locally, but for now it's only available in the azure-rest-api-specs repo and the package is not published. You can clone the repo and run it from there, though it assumes everything is run from within that repo, so it may have issues elsewhere.
The current focus for engineering system improvements is the azure-rest-api-specs repo itself. You can use draft PRs to validate work in progress, and some of the checks can be run locally—with varying levels of usability.

# TypeSpec Validation error

## question 
I have error: https://github.com/Azure/azure-rest-api-specs/actions/runs/16475997770/job/46577654359?pr=35887:
```
Rule Compile failed
  {"not_added":[],"conflicted":[],"created":[],"deleted":[],"modified":["specification/compute/resource-manager/Microsoft.Compute/GalleryRP/stable/2025-03-03/GalleryRP.json"],"renamed":[],"files":[{"path":"specification/compute/resource-manager/Microsoft.Compute/GalleryRP/stable/2025-03-03/GalleryRP.json","index":" ","working_dir":"M"}],"staged":[],"ahead":0,"behind":0,"current":"HEAD","tracking":null,"detached":true}diff --git a/specification/compute/resource-manager/Microsoft.Compute/GalleryRP/stable/2025-03-03/GalleryRP.json b/specification/compute/resource-manager/Microsoft.Compute/GalleryRP/stable/2025-03-03/GalleryRP.json
  index 58f42ef3f..cc93d3906 100644
  --- a/specification/compute/resource-manager/Microsoft.Compute/GalleryRP/stable/2025-03-03/GalleryRP.json
  +++ b/specification/compute/resource-manager/Microsoft.Compute/GalleryRP/stable/2025-03-03/GalleryRP.json
  @@ -7079,8 +7079,7 @@
             "description": "Optional. Any input parameters that needs to passed to the script and are accessed within the script for its execution.",
             "items": {
               "$ref": "#/definitions/GalleryScriptParameter"
  -          },
  -          "x-ms-identifiers": []
  +          }
           }
         },
         "required": [
  
  Files have been changed after `tsp compile`. Run `tsp compile` and ensure all files are included in your change.
  Error: TypeSpec Validation failed for project specification/compute/Gallery.Management run the following command locally to validate.
   > npm ci
   > npx tsv specification/compute/Gallery.Management
  For more detailed docs see https://aka.ms/azsdk/specs/typespec-validation
```
 
Is it because I have
```
  @@ -7079,8 +7079,7 @@
             "description": "Optional. Any input parameters that needs to passed to the script and are accessed within the script for its execution.",
             "items": {
               "$ref": "#/definitions/GalleryScriptParameter"
  -          },
  -          "x-ms-identifiers": []
  +          }
           }
         },
         "required": [
```
where x-ms-identifier is empty? That is intended. 

## answer
The swagger generated by TypeSpec is constantly changing across TypeSpec versions.  Do you believe the new swagger is incorrect?
 
Also, keep in mind the version of TypeSpec may be different in main, the base and source branches of your PR, and locally.  Unless you think the new generated swagger is incorrect, you want to update forward.
x-ms-identifier is no longer needed https://github.com/Azure/typespec-azure/issues/2868:
```
issue 2868:
title: [Deprecation] x-ms-identifiers extension is no longer useful
content: As title, and confirmed by @cweining, this swagger extension is completely useless for them who is from the original team that added this extension in swagger. Please remove it from typespec-autorest emitter
```

# Define Proxy object with 200/202 Http response

## question 
How do I define a Put API for ARM proxy object which should return 200 or 202 success response .  Example : ProxyResource

## answer
You shouldn't.  PUT operations should return 200 and 201, per the RPC.  There are some templates that allow overriding the default responses, but this would only be appropriate for older APIs.  Newer APIs should not define such operations.

# Generating Examples in typespec/swagger

## question 
Objective :  Generating MinMax set examples
PR :[Introduce first Public Preview API version for microsoft.fileshares (2025-06-01-preview) by afedyashov · Pull Request #36135 · Azure/azure-rest-api-specs](https://github.com/Azure/azure-rest-api-specs/pull/36135) 
Problem 1 :  How do we control naming 
oav generate-examples is updating swagger as "Operations_List_MinimumSet_Gen"
npx tsv  updates the swagger as "Operations_List_MinimumSet":
```
+ "Operations_List_MinimumSet": {
    "$ref": "./examples/Operations_List_MinimumSet_Gen.json"
}
```
Problem 2  : npx tsv is removing MinimumSet example generated by oav generate-examples
```
{
  "x-ms-examples": {
-    "FileShares_ListBySubscription_MaximumSet_Gen": {
+    "FileShares_ListBySubscription_MaximumSet": {
        "$ref": "./examples/FileShares_ListBySubscription_MaximumSet_Gen.json"
-    },
-    "FileShares_ListBySubscription_MinimumSet_Gen": {
-      "$ref": "./examples/FileShares_ListBySubscription_MinimumSet_Gen.json"
    }
```
Problem 3 :  How do I synchronize examples in typespec and swagger folder
 
Problem 4 : oav generate examples for minimum set  is adding an item with location property in it
```
{
  "title": "FileShareSnapshot_List_MinimumSet - generated by [MinimumSet] rule",
  "operationId": "FileShareSnapshot_List",
  "parameters": {
    "api-version": "2025-06-01-preview",
    "subscriptionId": "0681745E-3F9F-4966-80E6-69624A3B29F2",
    "resourceGroupName": "rgfileshares",
    "resourceName": "Replace this value with a string matching RegExp ^([a-z]|[0-9])
  },
  "responses": {
    "200": {
      "body": {
        "value": [
          {
            "location" : “Fjksielghsnf”
          }
        ]
      }
    }
  }
}
```

## answer
For Problem 1,  The 'title' field in the example file determines the name of the example in the 'x-ms-examples' extension, file names have nothing to do with it.  TypeSpec and tsv have no preference for the names of example files, as long as they are in the configured example directory.  It is possible, however, for an example to be dropped if it shares the same 'title'  and 'operation Id'  with another example file.
For Problem 2, oav generate-examples is a best-effort tool to help you get started generating examples from Swagger.  You may need to further edit the examples after generation.
For Problem 3, The source of truth for your examples, is the "examples" folder alongside your TSP sources.  tsp compile copies these examples alongside your generated swagger.
For Problem 4,  'location' is required in any tracked resource, so a set of values with one resource would have this property.
