# Updating from `@typespec/compiler@^0.65.0` -> `1.2.0`. Changes to `@service` decorator.

**Category: Decorators**

## question 
Hello, looking to migrate versions of the TSP compiler, I ran into a problem with the `@service` decorator. With the older version (0.65.0) we were able to attached more information to the `@service` by defining it like this:
```
@service({
  title: "Azure OpenAI Service",
  termsOfService: "https://openai.com/policies/terms-of-use",
  contact: {
    name: "OpenAI Support",
    url: "https://help.openai.com",
  },
  license: {
    name: "MIT",
    url: "https://github.com/openai/openai-openapi/blob/master/LICENSE",
  },
})
```
But after the update, the only admissible field seems to be `title` . I tried looking at the documentation, but I was not able to find a replacement for this. Currently, in order to compile, I had to change the above code to:
```
@service(#{
  title: "Azure OpenAI Service",
  // termsOfService: "https://openai.com/policies/terms-of-use",
  // contact: #{
  //   name: "OpenAI Support",
  //   url: "https://help.openai.com",
  // },
  // license: #{
  //   name: "MIT",
  //   url: "https://github.com/openai/openai-openapi/blob/master/LICENSE",
  // },
})
```
Thank you for any help you can provide. Apologies if I missed something immensely obvious that I should be doing. 

## answer
All the other options where never available and just silently dropped. If you meant to have this in the openapi document you should use @info from openapi library

# PR TypeSpec validation fails with Failed to find "Failed to find "options.@azure-tools/

**Category: TypeSpec Validation**

## question 
Hello, ever since I updated the ReadMe.md to point to our newest preview version the typespec validation fails with errors that start with "Failed to find "options.@azure-tools/"
ex:
- Failed to find "options.@azure-tools/typespec-python.generate-sample" with expected value "true". Please add "options.@azure-tools/typespec-python.generate-sample" with expected value "true".
 
I didn't need this in our prior versions so I'm not sure whats going on here?
 
Updated ReadMe
### Basic Information
 
These are the global settings for the azuredatatransfer.
 
``` yaml
openapi-type: arm
openapi-subtype: rpaas
tag: package-preview-2025-05-30-preview
```
 
### Tag: package-preview-2025-05-30-preview
 
These settings apply only when `--tag=package-preview-2025-05-30-preview` is specified on the command line.
 
```yaml $(tag) == 'package-preview-2025-05-30-preview'
input-file:
  - Private.AzureDataTransfer/preview/2025-05-30-preview/azuredatatransfer.json
```
 
 
Old ReadMe:
``` yaml
openapi-type: arm
openapi-subtype: rpaas
tag: package-preview-2025-04-11-preview
```

## answer
This is a new rule that applies to your tspconfig.yaml (not your readme.md).  Errors need to be either fixed or suppressed:
https://github.com/Azure/azure-rest-api-specs/wiki/TypeSpec-Validation#suppressing-sdktspconfigvalidation-rules:

Suppressing SdkTspConfigValidation Rules
The SdkTspConfigValidation rule is responsible for validating emitter options and parameters defined in your tspconfig.yaml file. You have the flexibility to suppress this rule entirely or target specific sub-rules within it.

Suppress the Entire SdkTspConfigValidation Rule
If you need to skip all validation checks for emitter options and parameters within a particular tspconfig.yaml file, you can suppress the entire SdkTspConfigValidation rule.

To do this, add or update the suppressions.yaml file in your service's root folder with the following content:
```
- tool: TypeSpecValidation
  paths:
    # Specify the path to the tspconfig.yaml file where suppression should apply
    - /path/to/tspconfig.yaml
  rules:
    - SdkTspConfigValidation
  reason: the-reason-you-want-to-suppress # Explain why this suppression is necessary
```
Suppress Specific Sub-rules within SdkTspConfigValidation
If you only need to bypass validation for specific emitter options or parameters, you can suppress individual sub-rules. Add or update your suppressions.yaml file with the following structure, specifying the sub-rules to ignore: Sub-rule Syntax:

For parameters: parameters.<parameter-key>.default
For emitter options: options.<emitter-name>.<option-key>
For nested options (e.g., package-details: name: "xxx"), use dot notation: options.<emitter-name>.package-details.name
```
- tool: TypeSpecValidation
  paths:
    # Specify the path to the tspconfig.yaml file where suppression should apply
    - /path/to/tspconfig.yaml
  rules:
    - SdkTspConfigValidation
  sub-rules:
    # Example: Suppress validation for a specific parameter's default value
    - parameters.<key-to-validate>.default 
    # Example: Suppress validation for a specific emitter option
    - options.<emitter-name>.<key-to-validate>
    # Example: Suppress validation for a nested emitter option
    - options.<emitter-name>.package-details.name 
  reason: the-reason-you-want-to-suppress # Explain why this suppression is necessary
```

# Swagger LintDiff - Analyze Code failing in PR

**Category: TypeSpec Validation**

## question 
I have the following PR that is currently failing: [[CTSRP] Update models for old version to be typespec compatible by joschung · Pull Request #23680 · Azure/azure-rest-api-specs-pr](https://github.com/Azure/azure-rest-api-specs-pr/pull/23680)
The error message isn't clear as to why the LintDiff is failing for my PR. Here is a picture of the error:
```
Run echo "summary=$GITHUB_STEP_SUMMARY" >> $GITHUB_OUTPUT

echo "summary=$GITHUB_STEP_SUMMARY" >> $GITHUB_OUTPUT

npm exec --no -- lint-diff \
--before before \ 
--after after \ 
--changed-files-path changed-files.txt \ 
--base-branch RP5aa5Dev \ 
--compare-sha 4c38db95d583774352f75251aaf02408935856a8 \
--out-file $GITHUB_STEP_SUMMARY

shell: /usr/bin/bash -e {0}
env:
NODE_OPTIONS: --max-old-space-size=8192

Using @microsoft.azure/openapi-validator version: 2.2.4

file:///home/runner/work/azure-rest-api-specs-pr/azure-rest-api-specs-pr/.github/shared/src/spec-model.js:150
throw new Error(`No affected swaggers found in specModel for ${swaggerPath}`);
^

Error: No affected swaggers found in specModel for /home/runner/work/azure-rest-api-specs-pr/azure-rest-api-specs-pr/before/specification/azuredatatransfer/resource-manager/Private.AzureDataTransfer/stable/2025-05-21/azuredatatransfer.json
    at SpecModel.getAffectedSwaggers (file:///home/runner/work/azure-rest-api-specs-pr/.github/shared/src/spec-model.js:150:13)
    at async buildState (file:///home/runner/work/azure-rest-api-specs-pr/tools/lint-diff/dist/src/processChanges.js:117:28)
    at async getRunList (file:///home/runner/work/tools/lint-diff/dist/src/processChanges.js:29:27)
    at async runLintDiff (file:///home/tools/lint-diff/dist/src/lint-diff.js:78:53)
    at async main (file:///home/tools/lint-diff/dist/src/lint-diff.js::73.5)
    at async file://tools/cmd/lint-diff/js::1

Node.js v22.17.0

Error Process completed with exit code 1.
```
How do I fix this?

## answer
The error message points to the problem:
```
No affected swaggers found in specModel for /home/runner/work/azure-rest-api-specs-pr/azure-rest-api-specs-pr/before/specification/azuredatatransfer/resource-manager/Private.AzureDataTransfer/stable/2025-05-21/azuredatatransfer.json
```
This means, the file in the error message was not reachable, either directly or via a reference, from your readme.md.  Either add the file to your readme.md, or delete the file.

# Best replacement for char in TypeSpec?

**Category: Decorators**

## question 
Hi TypeSpec Discussion,
We have a char type property in our contract, but I found that TypeSpec does not support char type.
 
Which type should I use in TypeSpec definition?

## answer
it is usually simpler and more explicit to add maxLength and minLength constraints to the custom scalar, [like this](https://typespec.io/playground/?e=%40typespec%2Fopenapi3&c=QG1heExlbmd0aCgxKQ0KQG1pbssPc2NhbGFyIGNoYXIgZXh0ZW5kcyBzdHJpbmc7DQo%3D&options=%7B%7D&vs=%7B%7D), rather than using the pattern decorator
```
@maxLength(1)
@minLength(1)
scalar char extends string;
```

# TypeSpec Versioning Generic Question

**Category: Versioning**

## question 
Hello, as of now our repository ([azure-rest-api-specs-pr/specification/azuredatatransfer/AzureDataTransfer.Management at RPSaaSDev · Azure/azure-rest-api-specs-pr](https://github.com/Azure/azure-rest-api-specs-pr/tree/RPSaaSDev/specification/azuredatatransfer/AzureDataTransfer.Management)) just introduced typespec and previously was using manual updates.
 
Regarding API Version updates, I wanted to know if we can remove previous preview versions (4-11) from our [main.tsp](https://github.com/Azure/azure-rest-api-specs-pr/blob/RPSaaSDev/specification/azuredatatransfer/AzureDataTransfer.Management/main.tsp#L35):
```
/**
 * PLEASE DO NOT REMOVE - USED FOR CONVERTER METRICS
 * Generated by package: @autorest/openapi-to-typespec
 * Parameters used:
 *   isFullCompatible: false
 *   guessResourceKey: false
 * Version: 0.11.0
 * Date: 2025-05-13T20:15:12.229Z
 */
import "@typespec/rest";
import "@typespec/versioning";
import "@azure-tools/typespec-azure-core";
import "@azure-tools/typespec-azure-resource-manager";
import "./models.tsp";
import "./FlowProfile.tsp";
import "./Connection.tsp";
import "./Pipeline.tsp";
import "./Flow.tsp";
import "./ProviderActions.tsp";

using Azure.ResourceManager;
using TypeSpec.Versioning;
/**
 * Azure Data Transfer service resource provider
 */
@armProviderNamespace
@service(#{ title: "azuredatatransferrp" })
@versioned(Versions)
@armCommonTypesVersion(Azure.ResourceManager.CommonTypes.Versions.v5)
namespace Private.AzureDataTransfer;

/**
 * The available API versions.
 */
enum Versions {
  /**
   * The 2025-04-11-preview API version.
   */
  @useDependency(Azure.ResourceManager.Versions.v1_0_Preview_1)
  @useDependency(Azure.Core.Versions.v1_0_Preview_1)
  v2025_04_11_preview: "2025-04-11-preview",

  /**
   * The 2025-05-21 API version.
   */
  @useDependency(Azure.ResourceManager.Versions.v1_0_Preview_1)
  @useDependency(Azure.Core.Versions.v1_0_Preview_1)
  v2025_05_21: "2025-05-21",

  /**
   * The 2025-05-30-preview API version.
   */
  @useDependency(Azure.ResourceManager.Versions.v1_0_Preview_1)
  @useDependency(Azure.Core.Versions.v1_0_Preview_1)
  v2025_05_30_preview: "2025-05-30-preview",
}

interface Operations extends Azure.ResourceManager.Operations {}
```
or if there is a recommended safe practice.
For the newest version I used the @added/removed decorators to add/remove certain properties/fields from the newest/olders versions. However, I'm not sure I want to always include the @added/removed decorators as we create new versions.
How do we manage this?
Also, does removing from the newest version count as a breaking change? I was under the impression that as long as we support it in prior versions and our backend supports it, we should be find to remove certain fields and properties.

## answer
It is generally recommended that you have only one active preview api, but this has to be balanced with ARM retention requirements for preview APIs.  For APIs that are not public to customers,  I don't see any need for them to remain once your tests no longer use those api versions

# TypeSpec Avocado failing even with labels tag

**Category: TypeSpec Validation**

## question 
I have the following PR that is currently failing: [[CTSRP] Update models for old version to be typespec compatible by joschung · Pull Request #23680 · Azure/azure-rest-api-specs-pr](https://github.com/Azure/azure-rest-api-specs-pr/pull/23680)
Here is a picture of the avocado failure:
```
Run Avocado

Run AVOCADO_OUTPUT_FILE=$RUNNER_TEMP/avocado.ndjson
avocadoDir: /home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager
avocadoDir: /home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager

{"level":"Error","code":"MISSING_APIS_IN_DEFAULT_TAG","message":"The default tag should contain all APIs. The API path `/providers/private.azuredatatransfer/validateschema` is not in the default tag. Please make sure the missing API swaggers are in the default tag.","tag":"default","readMeUrl":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/readme.md","jsonUrl":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/private.azuredatatransfer.json","path":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/private.AzureDataTransfer/preview/2025-04-11-preview/azuredatatransfer.json","apiPath":"/providers/private.azuredatatransfer/validateschema"}

{"level":"Error","code":"MISSING_APIS_IN_DEFAULT_TAG","message":"The default tag should contain all APIs. The API path `/providers/private.azuredatatransfer/listapprovedschemas` is not in the default tag. Please make sure the missing API swaggers are in the default tag.","tag":"default","readMeUrl":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/readme.md","jsonUrl":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/private.AzureDataTransfer/preview/2025-04-11-preview/azuredatatransfer.json","path":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/private.AzureDataTransfer/preview/2025-04-11-preview/azuredatatransfer.json","apiPath":"/providers/private.azuredatatransfer/listapprovedschemas"}

{"level":"Error","code":"MISSING_APIS_IN_DEFAULT_TAG","message":"The default tag should contain all APIs. The API path `/subscriptions/{}/resourceGroups/{}/providers/private.azuredatatransfer/pipelines/{}/listschemas` is not in the default tag. Please make sure the missing API swaggers are in the default tag.","tag":"default","readMeUrl":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/readme.md","jsonUrl":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/private.AzureDataTransfer/preview/2025-04-11-preview/azuredatatransfer.json","path":"/home/runner/work/azure-rest-api-specs-pr/c93b354fd9c14905bb574a8834c46d9b/specification/azuredatatransfer/resource-manager/private.AzureDataTransfer/preview/2025-04-11-preview/azuredatatransfer.json","apiPath":"/subscriptions/{}/resourceGroups/{}/providers/private.azuredatatransfer/pipelines/{}/listschemas"}

errors: 3
##vso[task.setVariable variable=validationResult]failure

Error: Process completed with exit code 1.
```
However, I have the Approved-Avocado label on my PR so I'm unsure as to why this is still running?

## answer
Your PR is merged, so I can't see the status checks anymore.  My guess is you confused the intermediate check "Swagger Avocado - Analyze Code" with the final required check "Swagger Avocado".

# is sdk generation required for private preview?

**Category: SDK Generation**

## question 
we are trying to get our api approved for a private preview, but our preview customers do not require an SDK. We were hoping to onboard to SDK later.
 
I'm a bit confused. Does api approval always include SDK? If not, how do we setup tspconfig to validate.
 
we are creating an arm api / not dataplane. I've seen some tspconfig.yaml without sdk configs, but when i try removing them I encounter tsv failures.

## answer
An SDK is NOT required for Private Preview
You just need to have your API Spec signed off
Have you created a release plan? If not, that is mandatory for sign off and will walk you thru step by step [aka.ms/azsdk/onboard](https://aka.ms/azsdk/onboard) and [aka.ms/azsdkdocs/release-plans](https://aka.ms/azsdkdocs/release-plans)
As of today how the system is designed, you need to suppress those warning if you do not want to include SDK at this time. See an example:
https://github.com/Azure/azure-rest-api-specs/blob/main/specification/monitor/Azure.Monitor.Ingestion/suppressions.yaml
When you will need SDK, you will be required to remove the file and follow the config validation process.
